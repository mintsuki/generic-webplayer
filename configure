#!/bin/sh

set -e

# Defaults
PREFIX="/usr/local"
WEBAPP_URL="about:blank"
PLAYER_NAME="about_blank"
PLAYER_NICE_NAME="About Blank"

for i in "$@"; do
	case $i in
		--prefix=*)
			PREFIX="${i#*=}"
			;;
		--webapp-url=*)
			WEBAPP_URL="${i#*=}"
			;;
		--player-name=*)
			PLAYER_NAME="${i#*=}"
			;;
		--player-nice-name=*)
			PLAYER_NICE_NAME="${i#*=}"
			;;
		--help | -h)
cat <<EOF
Web player configuration program.

Available options:

    --prefix=PATH            Specifies the path where the player will be
                             installed to.
                             (default: $PREFIX)

    --webapp-url=URL         The URL of the webapp the player will load at
                             startup.
                             (default: $WEBAPP_URL)

    --player-name=NAME       The raw name of the player app (no spaces, caps...)
                             (default: $PLAYER_NAME)

    --player-nice-name=NAME  The pretty name for the player app (spaces, caps...)
                             (default: $PLAYER_NICE_NAME)

    --help                   Shows this help.

EOF
			exit 0
			;;
		*)
			printf "Unknown option: $i\n"
			exit 1
			;;
	esac
done

printf "Prefix:           $PREFIX\n"
printf "Webapp URL:       $WEBAPP_URL\n"
printf "Player name:      $PLAYER_NAME\n"
printf "Player nice name: $PLAYER_NICE_NAME\n"

rm -rf work
mkdir work
cd src
for i in $(echo *); do
    sed "
s|@@prefix@@|$PREFIX|g;
s|@@webapp_url@@|$WEBAPP_URL|g;
s|@@player_name@@|$PLAYER_NAME|g;
s|@@player_nice_name@@|$PLAYER_NICE_NAME|g
" < "$i" > "../work/$i"
done
